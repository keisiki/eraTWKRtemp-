@SKIP_MOVE_5(ARG:0, ARG:1)

;현재위치 취득
LOCAL:0 = CFLAG:MASTER:현재위치
SIF ARG:1
	LOCAL = ARG:1

;잠정 목적지에 직접 이동할 수 있는 경우
IF CAN_MOVE(LOCAL, ARG) & 1
	;거기에 이동
	RETURN ARG
ENDIF

;막다른 골목으로부터 갈 수 있는 장소는 고정이므로, 거기를 목표로 한다
SELECTCASE LOCAL
;향림당으로부터는 마법의숲 입구만
CASE 502
	RETURN 501
;무연총으로부터는 재고의길만
CASE 506
	RETURN 509
CASE 512 TO 514
	RETURN 511
CASE 526
	RETURN 525
CASE 528,531
	RETURN 530
CASE 534
	RETURN 501
CASE 535 TO 537
	RETURN 534
CASE 541 TO 543
	RETURN 540
CASE 544
	RETURN 508
ENDSELECT

SIF INRANGE(LOCAL, 521, 533) && !INRANGE(ARG, 520, 533)
	RETURN 520

;직접 이동할 수 없는 경우,  1개가까운 위치를 잠정 목적지로 다시 설정해 루프
;지점 추가시 요점 보충(전케이스 수정하는 것)
SELECTCASE ARG
	CASE 501
		;마법의숲 입구에 직접 안 되면 갈림길을 목표로 한다
		RETURN 503
	CASE 502
		;향림당에 직접 안 되면 마법의숲 입구를 목표로 한다
		RETURN 501
	CASE 503
		IF INRANGE(LOCAL, 521,533)
			RETURN 520
		ELSEIF INRANGE(LOCAL, 534,537)
			RETURN 501
		ELSE
		;마법의숲 광장을 목표로 한다
			RETURN 508
		ENDIF
	CASE 506
		RETURN 509
	CASE 507
		SELECTCASE LOCAL:0
			CASE 501 TO 503, 520 TO 530, 540 TO 545
				RETURN 540
			CASE 534
				RETURN 501
			CASEELSE
				RETURN 508
		ENDSELECT
	CASE 508
		SELECTCASE LOCAL:0
			CASE 511 TO 514
				RETURN 510
			CASE 506
				RETURN 509
			CASE 515,501, 502
				RETURN 503
			CASEELSE
				RETURN 507
		ENDSELECT
	CASE 509
		RETURN 508
	CASE 510
		SELECTCASE LOCAL:0
			CASE 512 TO 515
				RETURN 511
			CASEELSE
				RETURN 508
		ENDSELECT
	CASE 511
		RETURN 510
	CASE 512 TO 514
		RETURN 511
	CASE 515
		SELECTCASE LOCAL:0
			CASE 510 TO 514
				RETURN 511
			CASEELSE
				RETURN 503
		ENDSELECT
	CASE 520
		SELECTCASE LOCAL:0
			CASE 506 TO 509, 540 TO 545 
				RETURN 540
			CASE 523 TO 531
				RETURN 525
			CASEELSE
				RETURN 503
		ENDSELECT
	CASE 521,522
		SELECTCASE LOCAL:0
			CASE 521 TO 533
				RETURN 525
			CASEELSE
				RETURN 520
		ENDSELECT
	CASE 523,524
		SELECTCASE LOCAL:0
			CASE 528,531
				RETURN 530
			CASE 520 TO 527,529,530
				RETURN 525
			CASEELSE
				RETURN 520
		ENDSELECT
	CASE 525
		SELECTCASE LOCAL:0
			CASE 528,531
				RETURN 530
			CASEELSE
				RETURN 520
		ENDSELECT
	CASE 526
		RETURN 525
	CASE 528,531
		RETURN 530
	CASE 529
		SELECTCASE LOCAL:0
			CASE 528,531
				RETURN 530
			CASEELSE
				RETURN 525
		ENDSELECT
	CASE 530
		RETURN 525
	CASE 534
		RETURN 501
	CASE 535 TO 537
		RETURN 534
	CASE 540
		SELECTCASE LOCAL:0
			CASE 506 TO 509
				RETURN 507
			CASE 521 TO 533
				RETURN 520
			CASEELSE
				RETURN 503
		ENDSELECT
	CASE 541 TO 543
		RETURN 540
	;나루미의 집
	CASE 544
		RETURN 508
ENDSELECT
